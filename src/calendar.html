<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–∞–≤–æ—Å–ª–∞–≤–µ–Ω –∫–∞–ª–µ–Ω–¥–∞—Ä</title>
    <link rel="stylesheet" href="print.css" media="print">
    <style>
        body { font-family: sans-serif; }
        .navigation { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1em; }
        #current-month-year { font-size: 1.5em; font-weight: bold; }
        .month-container { display: none; }
        .month-container.active { display: block; }
        .month-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 2em; }
        .day, .day-name { border: 1px solid #ccc; padding: 10px; min-height: 100px; position: relative; cursor: pointer; }
        .day-name { font-weight: bold; text-align: center; min-height: unset; cursor: default; }
        .day-name.saturday { color: blue; }
        .day-name.sunday { color: red; }
        .day-number { font-weight: bold; }
        .saturday { background-color: #e6f7ff; }
        .saturday .day-number { color: blue; }
        .sunday { background-color: #fff0f0; }
        .sunday .day-number { color: red; }
        .feasts { margin-top: 5px; }
        .feasts ul { list-style-type: none; padding-left: 0; }
        .feasts li { display: flex; align-items: center; justify-content: center; }
        .feasts li:hover { background-color: #f0f0f0; }
        .feasts li.fasting:before { content: 'üå±'; margin-right: 5px; }
        .orthodox-cross { color: purple; margin-right: 5px; font-size: 1.2em; vertical-align: middle; }
        .national-event { color: red; }
        .orthodox-event { color: purple; }
        .fasting-event { color: green; }
        .name-day-event { color: orange; }
        .current-day { background-color: #ffffcc; border: 2px solid #ffcc00; }
        .selected-day { background-color: #d0d0d0; }
        #search-results, #date-range-results { margin-top: 1em; }

        #details-container {
            display: none;
            gap: 1em;
        }

        #event-details {
            padding: 1em;
            border: 1px solid #ccc;
            text-align: center;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        #event-details h4 {
            width: 100%; /* Make date header full width */
        }

        .event-items-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1em;
            width: 100%;
        }

        #note-container {
            padding: 1em;
            border: 1px solid #ccc;
            text-align: center;
        }

        #event-details .event-item { 
            margin-bottom: 1em; 
            padding: 1em; 
            border: 1px solid #eee;
            flex: 1 1 200px; /* Allow items to grow and shrink */
            max-width: 300px;
        }
        #event-details .orthodox-event { border-color: purple; }
        #event-details .national-event { border-color: red; }
        #event-details .fasting-event { border-color: green; }
        #event-details .name-day-event { border-color: orange; }
        
        /* Note Styles */
        #notes-list {
            margin-top: 1em;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1em;
        }
        .note-item {
            background-color: #ffffcc; /* Yellow background */
            border: 1px solid #ffcc00;  /* Yellow border */
            margin-bottom: 1em;       /* Match event-item */
            padding: 1em;             /* Match event-item */
            text-align: center;
            flex: 1 1 200px;
            max-width: 300px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .note-item p { 
            margin: 0;
            margin-bottom: 10px;
            color: #333; /* Darker font color for better readability */
            word-wrap: break-word;
        }
        .note-item .buttons { 
            display: flex; 
            justify-content: center; 
            gap: 10px; /* Spacing between buttons */
            margin-top: auto; /* Push buttons to the bottom */
        }
        .note-icons-container { position: absolute; top: 5px; right: 5px; display: flex; flex-wrap: wrap; justify-content: flex-end; }
        .note-icon { font-size: 1em; opacity: 0.3; }
        .has-note .note-icon { opacity: 1; }

        #add-note-btn {
            display: none; /* Initially hidden */
            margin: 1em auto 0;
        }

        @media (min-width: 800px) {
            #details-container {
                display: none;
                flex-direction: row;
            }
            #event-details, #note-container {
                flex: 1;
            }
        }

    </style>
</head>
<body>
    <h1>–ü—Ä–∞–≤–æ—Å–ª–∞–≤–µ–Ω –∫–∞–ª–µ–Ω–¥–∞—Ä</h1>
    <div class="navigation no-print">
        <button id="prev-month">&lt; –ü—Ä–µ–¥–∏—à–µ–Ω</button>
        <h2 id="current-month-year"></h2>
        <button id="next-month">–°–ª–µ–¥–≤–∞—â &gt;</button>
    </div>
    <div class="navigation no-print">
        <form id="jump-to-date">
            <select id="month-select"></select>
            <input type="number" id="year-input" placeholder="–ì–æ–¥–∏–Ω–∞" />
            <button type="submit">Go</button>
        </form>
    </div>
    <div class="navigation no-print">
        <form id="search-form">
            <input type="text" id="search-input" placeholder="–¢—ä—Ä—Å–µ–Ω–µ –Ω–∞ –ø—Ä–∞–∑–Ω–∏–∫" />
            <button type="submit">–¢—ä—Ä—Å–µ–Ω–µ</button>
            <button type="button" id="clear-search">–ò–∑—á–∏—Å—Ç–∏</button>
        </form>
    </div>
    <div class="navigation no-print">
        <form id="date-range-form">
            <input type="date" id="start-date">
            <input type="date" id="end-date">
            <button type="submit">–ü–æ–∫–∞–∂–∏</button>
        </form>
    </div>
    <div class="navigation no-print">
        <form id="filter-form">
            <label><input type="checkbox" name="filter" value="orthodox" checked> –ü—Ä–∞–≤–æ—Å–ª–∞–≤–Ω–∏</label>
            <label><input type="checkbox" name="filter" value="national" checked> –ù–∞—Ü–∏–æ–Ω–∞–ª–Ω–∏</label>
            <label><input type="checkbox" name="filter" value="fasting" checked> –ü–æ—Å—Ç–Ω–∏</label>
            <label><input type="checkbox" name="filter" value="name-day" checked> –ò–º–µ–Ω–Ω–∏ –¥–Ω–∏</label>
        </form>
    </div>
    <div class="navigation no-print">
        <button id="print-button">–ü–µ—á–∞—Ç</button>
    </div>
    <div id="calendar"></div>
    <div id="search-results"></div>
    <div id="date-range-results"></div>
    
    <div id="details-container" class="no-print">
        <div id="event-details"></div>
        <div id="note-container">
            <h3 id="note-date"></h3>
            <div id="notes-list"></div>
            <div id="note-editor" style="display: none;">
                <textarea id="note-textarea" rows="4" style="width: 100%;"></textarea>
                <button id="save-note-btn">–ó–∞–ø–∞–∑–∏</button>
            </div>
            <button id="add-note-btn">–î–æ–±–∞–≤–∏ –Ω–æ–≤–∞ –±–µ–ª–µ–∂–∫–∞</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/calendar-data')
                .then(response => response.json())
                .then(data => {
                    const calendarDiv = document.getElementById('calendar');
                    const searchResultsDiv = document.getElementById('search-results');
                    const dateRangeResultsDiv = document.getElementById('date-range-results');
                    const detailsContainer = document.getElementById('details-container');
                    const eventDetailsDiv = document.getElementById('event-details');
                    const noteContainer = document.getElementById('note-container');
                    const noteDateHeader = document.getElementById('note-date');
                    const notesList = document.getElementById('notes-list');
                    const noteEditor = document.getElementById('note-editor');
                    const noteTextarea = document.getElementById('note-textarea');
                    const saveNoteBtn = document.getElementById('save-note-btn');
                    const addNoteBtn = document.getElementById('add-note-btn');
                    const monthMap = { "—è–Ω—É–∞—Ä–∏": 0, "—Ñ–µ–≤—Ä—É–∞—Ä–∏": 1, "–º–∞—Ä—Ç": 2, "–∞–ø—Ä–∏–ª": 3, "–º–∞–π": 4, "—é–Ω–∏": 5, "—é–ª–∏": 6, "–∞–≤–≥—É—Å—Ç": 7, "—Å–µ–ø—Ç–µ–º–≤—Ä–∏": 8, "–æ–∫—Ç–æ–º–≤—Ä–∏": 9, "–Ω–æ–µ–º–≤—Ä–∏": 10, "–¥–µ–∫–µ–º–≤—Ä–∏": 11 };
                    const monthSelect = document.getElementById('month-select');
                    const yearInput = document.getElementById('year-input');
                    const filterCheckboxes = document.querySelectorAll('#filter-form input[name="filter"]');
                    let selectedDayElement = null;
                    let selectedDateForNote = '';
                    let notesForSelectedDate = [];
                    let editingNoteIndex = -1; // -1 for new note, >= 0 for editing

                    for (const monthName in monthMap) {
                        const option = document.createElement('option');
                        option.value = monthMap[monthName];
                        option.textContent = monthName.charAt(0).toUpperCase() + monthName.slice(1);
                        monthSelect.appendChild(option);
                    }
                    
                    const today = new Date();
                    const currentYear = today.getFullYear();
                    const currentMonth = today.getMonth();
                    const currentDay = today.getDate();

                    let currentMonthIndex = data.findIndex(monthData => {
                        const [monthName, year] = monthData.month.toLowerCase().split(' ');
                        return parseInt(year) === currentYear && monthMap[monthName] === currentMonth;
                    });

                    if (currentMonthIndex === -1) {
                        currentMonthIndex = 0; 
                    }

                    function getSelectedFilters() {
                        const selectedFilters = [];
                        filterCheckboxes.forEach(checkbox => {
                            if (checkbox.checked) {
                                selectedFilters.push(checkbox.value);
                            }
                        });
                        return selectedFilters;
                    }

                    function renderCalendar(print = false) {
                        calendarDiv.innerHTML = ''; 
                        searchResultsDiv.innerHTML = '';
                        dateRangeResultsDiv.innerHTML = '';
                        detailsContainer.style.display = 'none';
                        calendarDiv.style.display = 'block';
                        
                        const filters = getSelectedFilters();

                        if(print) {
                            data.forEach(monthData => {
                                calendarDiv.appendChild(createMonthGrid(monthData, filters));
                            });
                        } else {
                            const monthData = data[currentMonthIndex];
                            document.getElementById('current-month-year').textContent = monthData.month;
                            calendarDiv.appendChild(createMonthGrid(monthData, filters));
                        }
                        
                        document.getElementById('prev-month').disabled = currentMonthIndex === 0;
                        document.getElementById('next-month').disabled = currentMonthIndex === data.length - 1;
                        focusOnCurrentDay();
                    }

                    function createMonthGrid(monthData, filters) {
                        const monthContainer = document.createElement('div');
                        monthContainer.classList.add('month-container', 'active');
                        
                        const monthTitle = document.createElement('h2');
                        monthTitle.textContent = monthData.month;
                        monthContainer.appendChild(monthTitle);

                        const monthGrid = document.createElement('div');
                        monthGrid.classList.add('month-grid');

                        const daysOfWeek = ['–ü–æ', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–ù–¥'];
                        daysOfWeek.forEach((day, index) => {
                            const dayNameDiv = document.createElement('div');
                            dayNameDiv.classList.add('day-name');
                            if (index === 5) { dayNameDiv.classList.add('saturday'); }
                            if (index === 6) { dayNameDiv.classList.add('sunday'); }
                            dayNameDiv.textContent = day;
                            monthGrid.appendChild(dayNameDiv);
                        });

                        const [monthName, year] = monthData.month.toLowerCase().split(' ');
                        const monthIndex = monthMap[monthName];
                        const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();
                        let firstDayOfMonth = new Date(year, monthIndex, 1).getDay();
                        if (firstDayOfMonth === 0) firstDayOfMonth = 7;

                        for (let i = 1; i < firstDayOfMonth; i++) {
                            const blankDay = document.createElement('div');
                            monthGrid.appendChild(blankDay);
                        }

                        for (let day = 1; day <= daysInMonth; day++) {
                            const dayDiv = document.createElement('div');
                            dayDiv.classList.add('day');
                            const date = new Date(year, monthIndex, day);
                            const dayOfWeek = date.getDay();

                            if (dayOfWeek === 6) { dayDiv.classList.add('saturday'); }
                            if (dayOfWeek === 0) { dayDiv.classList.add('sunday'); }

                            if (parseInt(year) === currentYear && monthIndex === currentMonth && day === currentDay) {
                                dayDiv.classList.add('current-day');
                            }

                            const dateString = `${day} ${monthData.month}`;
                            dayDiv.addEventListener('click', () => handleDayClick(dayDiv, dateString, monthData.days[day] || []));

                            const dayNumber = document.createElement('div');
                            dayNumber.classList.add('day-number');
                            dayNumber.textContent = day;
                            dayDiv.appendChild(dayNumber);
                            
                            const noteIconsContainer = document.createElement('div');
                            noteIconsContainer.classList.add('note-icons-container');
                            dayDiv.appendChild(noteIconsContainer);

                            updateNoteIcons(dayDiv, dateString);

                            if (monthData.days[day]) {
                                const feasts = monthData.days[day].filter(feast => {
                                    if (filters.length === 0) return true;
                                    if (filters.includes('orthodox') && feast.type === 'orthodox') return true;
                                    if (filters.includes('national') && (feast.type === 'secular' || feast.type === 'non-working')) return true;
                                    if (filters.includes('fasting') && feast.type === 'fasting') return true;
                                    if (filters.includes('name-day') && feast.type === 'name-day') return true;
                                    return false;
                                });

                                if (feasts.length > 0) {
                                    const feastsDiv = document.createElement('div');
                                    feastsDiv.classList.add('feasts');
                                    const feastsList = document.createElement('ul');
                                    const sortedFeasts = feasts.sort((a, b) => {
                                        if (a.type === 'non-working') return -1;
                                        if (b.type === 'non-working') return 1;
                                        return 0;
                                    });

                                    sortedFeasts.forEach(feast => {
                                        const feastItem = document.createElement('li');
                                        let icon = '';
                                        if (feast.type === 'fasting') { 
                                            feastItem.classList.add('fasting-event'); 
                                            icon = 'üå±';
                                        } else if (feast.type === 'orthodox') { 
                                            feastItem.classList.add('orthodox-event');
                                            icon = '‚úù';
                                        } else if (feast.type === 'secular' || feast.type === 'non-working') { 
                                            feastItem.classList.add('national-event'); 
                                            icon = 'üáßüá¨';
                                        } else if (feast.type === 'name-day') {
                                            feastItem.classList.add('name-day-event');
                                            icon = 'üéÅ';
                                        }

                                        if (icon) {
                                            const iconSpan = document.createElement('span');
                                            iconSpan.textContent = icon;
                                            iconSpan.style.marginRight = '5px';
                                            if (icon === '‚úù') {
                                                iconSpan.classList.add('orthodox-cross');
                                            }
                                            feastItem.appendChild(iconSpan);
                                        }

                                        const feastName = document.createElement('span');
                                        feastName.textContent = feast.name;
                                        feastItem.appendChild(feastName);
                                        feastsList.appendChild(feastItem);
                                    });
                                    feastsDiv.appendChild(feastsList);
                                    dayDiv.appendChild(feastsDiv);
                                }
                            }
                            monthGrid.appendChild(dayDiv);
                        }
                        monthContainer.appendChild(monthGrid);
                        return monthContainer;
                    }

                    function getNotes(dateString) {
                        const notesJSON = localStorage.getItem(dateString);
                        if (!notesJSON) return [];
                        try {
                            const notes = JSON.parse(notesJSON);
                            return Array.isArray(notes) ? notes : [notes];
                        } catch (error) {
                            return [notesJSON]; 
                        }
                    }

                    function saveNotesToStorage(dateString, notes) {
                        if (notes && notes.length > 0) {
                            localStorage.setItem(dateString, JSON.stringify(notes));
                        } else {
                            localStorage.removeItem(dateString);
                        }
                        if (selectedDayElement) {
                            updateNoteIcons(selectedDayElement, dateString);
                        }
                    }
                    
                    function updateNoteIcons(dayElement, dateString) {
                        const noteIconsContainer = dayElement.querySelector('.note-icons-container');
                        noteIconsContainer.innerHTML = '';
                        const notes = getNotes(dateString);
                        if (notes.length > 0) {
                            dayElement.classList.add('has-note');
                            notes.forEach(() => {
                                const noteIcon = document.createElement('span');
                                noteIcon.classList.add('note-icon');
                                noteIcon.textContent = 'üìù';
                                noteIconsContainer.appendChild(noteIcon);
                            });
                        } else {
                            dayElement.classList.remove('has-note');
                        }
                    }

                    function handleDayClick(dayElement, dateString, feasts) {
                        if (selectedDayElement) {
                            selectedDayElement.classList.remove('selected-day');
                        }
                        dayElement.classList.add('selected-day');
                        selectedDayElement = dayElement;
                        selectedDateForNote = dateString;

                        const displayStyle = window.innerWidth >= 800 ? 'flex' : 'block';
                        detailsContainer.style.display = displayStyle;

                        eventDetailsDiv.innerHTML = '';
                        if (feasts.length > 0) {
                            const dateElement = document.createElement('h4');
                            dateElement.textContent = dateString;
                            eventDetailsDiv.appendChild(dateElement);

                            const eventItemsContainer = document.createElement('div');
                            eventItemsContainer.className = 'event-items-container';

                            feasts.forEach(feast => {
                                const eventItem = document.createElement('div');
                                eventItem.classList.add('event-item');
                                let icon = '', className = '';
                                if (feast.type === 'fasting') { 
                                    icon = 'üå±'; 
                                    className = 'fasting-event'; 
                                } else if (feast.type === 'orthodox') { 
                                    icon = '‚úù'; 
                                    className = 'orthodox-event'; 
                                } else if (feast.type === 'secular' || feast.type === 'non-working') { 
                                    icon = 'üáßüá¨'; 
                                    className = 'national-event'; 
                                } else if (feast.type === 'name-day') {
                                    icon = 'üéÅ';
                                    className = 'name-day-event';
                                }
                                eventItem.classList.add(className);
                                const title = document.createElement('h3');
                                title.textContent = `${icon} ${feast.name}`;
                                eventItem.appendChild(title);
                                const description = document.createElement('p');
                                description.textContent = feast.description || '–ù—è–º–∞ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.';
                                eventItem.appendChild(description);
                                eventItemsContainer.appendChild(eventItem);
                            });
                            eventDetailsDiv.appendChild(eventItemsContainer);
                        } else {
                            eventDetailsDiv.innerHTML = '<h4>–ù—è–º–∞ —Å—ä–±–∏—Ç–∏—è –∑–∞ —Ç–æ–∑–∏ –¥–µ–Ω.</h4>';
                        }

                        // Handle Notes
                        noteDateHeader.textContent = `–ë–µ–ª–µ–∂–∫–∏ –∑–∞ ${dateString}`;
                        notesForSelectedDate = getNotes(dateString);
                        renderNotesView();
                    }
                    
                    function renderNotesView() {
                        notesList.innerHTML = '';
                        noteEditor.style.display = 'none';
                        editingNoteIndex = -1;

                        if (notesForSelectedDate.length > 0) {
                            notesForSelectedDate.forEach((note, index) => {
                                const noteItem = document.createElement('div');
                                noteItem.classList.add('note-item');
                                
                                const noteText = document.createElement('p');
                                noteText.textContent = note;
                                noteItem.appendChild(noteText);
                                
                                const buttonsDiv = document.createElement('div');
                                buttonsDiv.classList.add('buttons');

                                const editBtn = document.createElement('button');
                                editBtn.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π';
                                editBtn.onclick = () => {
                                    editingNoteIndex = index;
                                    noteTextarea.value = notesForSelectedDate[index];
                                    noteEditor.style.display = 'block';
                                    notesList.style.display = 'none';
                                    addNoteBtn.style.display = 'none';
                                };

                                const deleteBtn = document.createElement('button');
                                deleteBtn.textContent = '–ò–∑—Ç—Ä–∏–π';
                                deleteBtn.onclick = () => {
                                    notesForSelectedDate.splice(index, 1);
                                    saveNotesToStorage(selectedDateForNote, notesForSelectedDate);
                                    renderNotesView();
                                };

                                buttonsDiv.appendChild(editBtn);
                                buttonsDiv.appendChild(deleteBtn);
                                noteItem.appendChild(buttonsDiv);
                                notesList.appendChild(noteItem);
                            });
                            notesList.style.display = 'flex';
                            addNoteBtn.style.display = 'block';
                        } else {
                            notesList.style.display = 'none';
                            noteEditor.style.display = 'block';
                            noteTextarea.value = '';
                            addNoteBtn.style.display = 'none';
                        }
                    }

                    addNoteBtn.onclick = () => {
                        editingNoteIndex = -1;
                        noteEditor.style.display = 'block';
                        noteTextarea.value = '';
                        noteTextarea.focus();
                        addNoteBtn.style.display = 'none';
                        notesList.style.display = 'none';
                    };

                    saveNoteBtn.onclick = () => {
                        const newNote = noteTextarea.value.trim();
                        if (newNote) {
                            if (editingNoteIndex > -1) {
                                notesForSelectedDate[editingNoteIndex] = newNote;
                            } else {
                                notesForSelectedDate.push(newNote);
                            }
                            saveNotesToStorage(selectedDateForNote, notesForSelectedDate);
                        }
                        renderNotesView();
                    };

                    function showSearchResults(results) {
                        calendarDiv.style.display = 'none';
                        searchResultsDiv.innerHTML = '';
                        dateRangeResultsDiv.innerHTML = '';
                        detailsContainer.style.display = 'none';

                        if (results.length > 0) {
                            const resultList = document.createElement('ul');
                            results.forEach(result => {
                                const resultItem = document.createElement('li');
                                const link = document.createElement('a');
                                link.href = '#';
                                link.textContent = `${result.day} ${result.month} - ${result.feast.name}`;
                                link.addEventListener('click', (e) => {
                                    e.preventDefault();
                                    const targetIndex = data.findIndex(monthData => monthData.month === result.month);
                                    if (targetIndex !== -1) {
                                        currentMonthIndex = targetIndex;
                                        renderCalendar();
                                        const dateString = `${result.day} ${result.month}`;
                                        const dayElement = findDayElementByDateString(dateString);
                                        if(dayElement) {
                                            const dayNumber = result.day;
                                            const monthData = data[targetIndex];
                                            const feasts = monthData.days[dayNumber] || [];
                                            handleDayClick(dayElement, dateString, feasts);
                                        }
                                    }
                                });
                                resultItem.appendChild(link);
                                resultList.appendChild(resultItem);
                            });
                            searchResultsDiv.appendChild(resultList);
                        } else {
                            searchResultsDiv.textContent = '–ù—è–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ—Ç–æ.';
                        }
                    }
                    
                    function findDayElementByDateString(dateString) {
                        const dayElements = document.querySelectorAll('.day');
                       for (const dayEl of dayElements) {
                            const dayNumberEl = dayEl.querySelector('.day-number');
                            if (dayNumberEl) {
                                const dayNumber = dayNumberEl.textContent.trim();
                                const monthName = document.getElementById('current-month-year').textContent;
                                if (`${dayNumber} ${monthName}` === dateString) {
                                    return dayEl;
                                }
                            }
                        }
                        return null;
                    }

                    function showDateRangeResults(results) {
                        calendarDiv.style.display = 'none';
                        searchResultsDiv.innerHTML = '';
                        dateRangeResultsDiv.innerHTML = '';
                        detailsContainer.style.display = 'none';

                        if (results.length > 0) {
                            const resultList = document.createElement('ul');
                            results.forEach(result => {
                                const resultItem = document.createElement('li');
                                resultItem.textContent = `${result.day} ${result.month} - ${result.feast.name}`;
                                resultList.appendChild(resultItem);
                            });
                            dateRangeResultsDiv.appendChild(resultList);
                        } else {
                            dateRangeResultsDiv.textContent = '–ù—è–º–∞ —Å—ä–±–∏—Ç–∏—è –≤ –∏–∑–±—Ä–∞–Ω–∏—è. ';
                        }
                    }

                    function focusOnCurrentDay() {
                        const currentDayElement = document.querySelector('.current-day');
                        if (currentDayElement) {
                            currentDayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }
                    
                    document.getElementById('prev-month').addEventListener('click', () => {
                        if (currentMonthIndex > 0) {
                            currentMonthIndex--;
                            renderCalendar();
                        }
                    });

                    document.getElementById('next-month').addEventListener('click', () => {
                        if (currentMonthIndex < data.length - 1) {
                            currentMonthIndex++;
                            renderCalendar();
                        }
                    });

                    document.getElementById('jump-to-date').addEventListener('submit', (e) => {
                        e.preventDefault();
                        const selectedMonth = parseInt(monthSelect.value);
                        const selectedYear = parseInt(yearInput.value);

                        if (!isNaN(selectedYear)) {
                            const newIndex = data.findIndex(monthData => {
                                const [monthName, year] = monthData.month.toLowerCase().split(' ');
                                return parseInt(year) === selectedYear && monthMap[monthName] === selectedMonth;
                            });

                            if (newIndex !== -1) {
                                currentMonthIndex = newIndex;
                                renderCalendar();
                            } else {
                                alert('–ù—è–º–∞ –¥–∞–Ω–Ω–∏ –∑–∞ –∏–∑–±—Ä–∞–Ω–∏—è –º–µ—Å–µ—Ü –∏ –≥–æ–¥–∏–Ω–∞.');
                            }
                        }
                    });

                    document.getElementById('search-form').addEventListener('submit', (e) => {
                        e.preventDefault();
                        const searchInput = document.getElementById('search-input');
                        const query = searchInput.value.toLowerCase();
                        const results = [];

                        if (query) {
                            data.forEach(monthData => {
                                for (const day in monthData.days) {
                                    monthData.days[day].forEach(feast => {
                                        if (feast.name.toLowerCase().includes(query)) {
                                            results.push({ month: monthData.month, day: day, feast: feast });
                                        }
                                    });
                                }
                            });
                        }
                        showSearchResults(results);
                    });

                    document.getElementById('clear-search').addEventListener('click', () => {
                        document.getElementById('search-input').value = '';
                        renderCalendar();
                    });

                    document.getElementById('date-range-form').addEventListener('submit', (e) => {
                        e.preventDefault();
                        const startDate = new Date(document.getElementById('start-date').value);
                        const endDate = new Date(document.getElementById('end-date').value);
                        const results = [];

                        if (startDate && endDate) {
                            data.forEach(monthData => {
                                const [monthName, yearStr] = monthData.month.toLowerCase().split(' ');
                                const year = parseInt(yearStr);
                                const month = monthMap[monthName];

                                for (const day in monthData.days) {
                                    const date = new Date(year, month, day);
                                    if (date >= startDate && date <= endDate) {
                                        monthData.days[day].forEach(feast => {
                                            results.push({ month: monthData.month, day: day, feast: feast });
                                        });
                                    }
                                }
                            });
                        }
                        showDateRangeResults(results);
                    });

                    filterCheckboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', () => {
                            renderCalendar();
                        });
                    });

                    document.getElementById('print-button').addEventListener('click', () => {
                        renderCalendar(true);
                        window.print();
                        renderCalendar();
                    });

                    renderCalendar();
                });
        });
    </script>
</body>
</html>
